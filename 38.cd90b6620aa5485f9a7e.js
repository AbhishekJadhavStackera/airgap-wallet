(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{cq7r:function(t,e,o){"use strict";o.r(e),o.d(e,"SubAccountAddPageModule",function(){return C});var i=o("138U"),n=o("ofXK"),c=o("3Pt+"),s=o("tyNb"),l=o("TEn/"),a=o("sYmb"),r=o("j1ZV"),d=o("mrSG"),b=o("RKiA"),u=o("Z7VQ"),h=o("peH2"),p=o("QMTT"),f=o("57MG"),y=o("kB5k"),g=o.n(y),m=o("fXoL");const S=function(t){return{typeLabel:t}};function w(t,e){if(1&t&&(m.Ob(0,"empty-state",13),m.dc(1,"translate"),m.dc(2,"translate")),2&t){const t=m.cc();m.ic("text",m.fc(1,3,"add-sub-account.no-imports_text",m.mc(8,S,m.ec(2,6,t.typeLabel))))("imageName",t.wallet.protocol.identifier===t.mainProtocolSymbols.XTZ?"no-imports.svg":"currencies-empty.svg")("fullHeight",t.wallet.protocol.identifier!==t.mainProtocolSymbols.XTZ)}}function P(t,e){if(1&t){const t=m.Tb();m.Sb(0,"ion-row",14),m.Sb(1,"ion-col",15),m.Sb(2,"portfolio-item",16),m.ac("click",function(){m.qc(t);const o=e.$implicit;return m.cc().toggleAccount(o)}),m.Rb(),m.Rb(),m.Sb(3,"ion-col",17),m.Sb(4,"ion-checkbox",18),m.ac("ngModelChange",function(t){return e.$implicit.selected=t}),m.Rb(),m.Rb(),m.Rb()}if(2&t){const t=e.$implicit,o=m.cc();m.Cb(2),m.ic("isToken",o.subProtocolType===o.subProtocolTypes.TOKEN)("wallet",t.wallet),m.Cb(2),m.ic("ngModel",t.selected)}}let v=(()=>{class t{constructor(t,e,o,i,n){if(this.navController=t,this.route=e,this.accountProvider=o,this.priceService=i,this.protocolService=n,this.mainProtocolSymbols=b.MainProtocolSymbols,this.subAccounts=[],this.filteredSubAccounts=[],this.displayedSubAccounts=[],this.subProtocolTypes=u.SubProtocolType,this.typeLabel="",this.searchTerm="",this.infiniteEnabled=!1,this.limit=10,this.loaded=0,this.publicKey=this.route.snapshot.params.publicKey,this.protocolID=this.route.snapshot.params.protocolID,this.addressIndex=this.route.snapshot.params.addressIndex,this.subProtocolType=this.route.snapshot.params.subProtocolType,"undefined"===this.addressIndex&&(this.addressIndex=void 0),this.wallet=this.accountProvider.walletByPublicKeyAndProtocolAndAddressIndex(this.publicKey,this.protocolID,this.addressIndex),this.route.snapshot.data.special){const t=this.route.snapshot.data.special;this.actionCallback=t.actionCallback,this.subProtocolType=t.subProtocolType,this.wallet=t.wallet}this.subProtocolType===u.SubProtocolType.ACCOUNT?this.initWithAccountSubProtocol():this.subProtocolType===u.SubProtocolType.TOKEN?this.initWithTokenSubProtocol():Object(h.assertNever)(this.subProtocolType)}toggleAccount(t){t.selected=!t.selected}addSubAccounts(){this.actionCallback({subAccounts:this.subAccounts,accountProvider:this.accountProvider,location:this.navController})}initWithAccountSubProtocol(){this.typeLabel="add-sub-account.accounts_label"}initWithTokenSubProtocol(){return Object(d.a)(this,void 0,void 0,function*(){this.typeLabel="add-sub-account.tokens_label";const t=(yield this.protocolService.getSubProtocols(this.wallet.protocol.identifier)).filter(t=>t.subProtocolType===u.SubProtocolType.TOKEN);this.infiniteEnabled=!0,this.subAccounts=yield this.loadSubAccounts(t),yield this.loadDisplayedAccounts()})}loadSubAccounts(t){return Object(d.a)(this,void 0,void 0,function*(){return(yield this.wallet.protocol.getBalanceOfPublicKeyForSubProtocols(this.wallet.publicKey,t)).map((e,o)=>{const i=this.accountProvider.findWalletGroup(this.wallet),n=new b.AirGapMarketWallet(t[o],this.wallet.publicKey,this.wallet.isExtendedPublicKey,this.wallet.derivationPath,this.wallet.masterFingerprint,this.wallet.status,this.priceService);if(!this.accountProvider.walletExists(n))return n.addresses=this.wallet.addresses,n.currentBalance=new g.a(e),{wallet:n,selected:!1,groupId:void 0!==i?i.id:void 0,groupLabel:void 0!==i?i.label:void 0}}).filter(t=>void 0!==t).sort((t,e)=>-1*t.wallet.currentBalance.minus(e.wallet.currentBalance).toNumber())})}setFilteredItems(t){if(this.displayedSubAccounts=[],this.loaded=0,0===t.length)this.infiniteEnabled=!0,this.loadDisplayedAccounts();else{const e=t.toLowerCase();this.filteredSubAccounts=this.subAccounts.filter(t=>{const o=t.wallet.protocol.name.toLowerCase().includes(e),i=t.wallet.protocol.symbol.toLowerCase().includes(e);return o||i}),this.infiniteEnabled=!1,this.loadDisplayedAccounts(!0)}}loadDisplayedAccounts(t=!1){return Object(d.a)(this,void 0,void 0,function*(){const e=(t?this.filteredSubAccounts:this.subAccounts).slice(this.loaded,this.loaded+this.limit);e.length<this.limit&&(this.infiniteEnabled=!1),e.forEach(t=>{void 0===t.wallet.currentMarketPrice&&t.wallet.fetchCurrentMarketPrice(),this.displayedSubAccounts.push(t)}),this.loaded+=e.length})}doInfinite(t){return Object(d.a)(this,void 0,void 0,function*(){if(!this.infiniteEnabled)return t.target.complete();yield this.loadDisplayedAccounts(),t.target.complete()})}}return t.\u0275fac=function(e){return new(e||t)(m.Nb(l.nb),m.Nb(s.a),m.Nb(f.a),m.Nb(p.a),m.Nb(i.x))},t.\u0275cmp=m.Hb({type:t,selectors:[["page-sub-account-add"]],decls:28,vars:23,consts:[[1,"ion-no-border"],["fixed","true",1,"ion-no-padding"],["slot","start"],["defaultHref","/"],[3,"ngModel","ngModelChange","ionChange"],[1,"ion-padding"],["color","primary",1,"font--weight__bold"],[3,"text","imageName","fullHeight",4,"ngIf"],["class","ion-no-padding",4,"ngFor","ngForOf"],[3,"ionInfinite"],["vertical","bottom","horizontal","end","slot","fixed"],["shape","round","color","secondary",3,"disabled","click"],["slot","start","name","add"],[3,"text","imageName","fullHeight"],[1,"ion-no-padding"],["size","10",1,"ion-no-padding"],["tappable","",3,"isToken","wallet","click"],["size","2",1,"content--align__center-center","ion-no-padding"],["color","primary",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(m.Sb(0,"ion-header",0),m.Sb(1,"ion-grid",1),m.Sb(2,"ion-toolbar"),m.Sb(3,"ion-buttons",2),m.Ob(4,"ion-back-button",3),m.Rb(),m.Sb(5,"ion-title"),m.yc(6),m.dc(7,"translate"),m.dc(8,"translate"),m.Rb(),m.Rb(),m.Sb(9,"ion-toolbar"),m.Sb(10,"ion-searchbar",4),m.ac("ngModelChange",function(t){return e.searchTerm=t})("ionChange",function(){return e.setFilteredItems(e.searchTerm)}),m.Rb(),m.Rb(),m.Rb(),m.Rb(),m.Sb(11,"ion-content"),m.Sb(12,"ion-grid",1),m.Sb(13,"ion-row",5),m.Sb(14,"ion-text",6),m.Sb(15,"span"),m.yc(16),m.dc(17,"translate"),m.Rb(),m.Rb(),m.Rb(),m.wc(18,w,3,10,"empty-state",7),m.wc(19,P,5,3,"ion-row",8),m.Rb(),m.Sb(20,"ion-infinite-scroll",9),m.ac("ionInfinite",function(t){return e.doInfinite(t)}),m.Ob(21,"ion-infinite-scroll-content"),m.Rb(),m.Sb(22,"ion-fab",10),m.Sb(23,"ion-button",11),m.ac("click",function(){return e.addSubAccounts()}),m.Ob(24,"ion-icon",12),m.yc(25),m.dc(26,"translate"),m.dc(27,"translate"),m.Rb(),m.Rb(),m.Rb()),2&t&&(m.Cb(6),m.zc(m.fc(7,7,"add-sub-account.title",m.mc(19,S,m.ec(8,10,e.typeLabel)))),m.Cb(4),m.ic("ngModel",e.searchTerm),m.Cb(6),m.zc(m.ec(17,12,e.typeLabel)),m.Cb(2),m.ic("ngIf",!e.subAccounts.length),m.Cb(1),m.ic("ngForOf",e.displayedSubAccounts),m.Cb(4),m.ic("disabled",!e.subAccounts.length),m.Cb(2),m.Ac(" ",m.fc(26,14,"add-sub-account.add-accounts_label",m.mc(21,S,m.ec(27,17,e.typeLabel)))," "))},styles:[".empty-list[_ngcontent-%COMP%]{height:50%}span[_ngcontent-%COMP%]{font-size:14px}"]}),t})();var A=o("1Mpf"),T=o("F07p");let C=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.Lb({type:t}),t.\u0275inj=m.Kb({imports:[[l.jb,n.c,c.e,r.a,a.b,s.j.forChild([{path:"",component:v}]),i.e]]}),t})();m.tc(v,[l.v,l.u,l.ib,l.j,l.f,l.g,l.gb,l.R,l.vb,c.h,c.j,l.q,l.Q,l.eb,n.o,A.a,n.n,l.p,T.a,l.o,l.b,l.x,l.y,l.r,l.i,l.w],[a.c])}}]);